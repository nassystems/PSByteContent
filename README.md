# PSByteContent

PowerShell で BOM をちょっと覗き見たり各種ヘッダーの BASE64 テキストをデコードしたり、バイト列をちょっと便利に扱えれば良いなくらいの軽い気持ちで作った関数群。

実行すると関数を定義する。ソース演算子で (自スコープで) 本スクリプトを実行たのち各種関数を呼び出しするのが、想定される使い方。

## 詳細

PowerShell では、配列平滑化 (unwrap) によりバイト配列が 1 バイトずつの処理に陥りやすいので、これを回避する実装とした。

例えば、

```PowerShell
Get-ByteContenct fromfilepath | Select-ByteContent -First 0x100 | Add-ByteContent tofilepath
```

の様に処理したとき、1 バイトずつパイプを渡るのではなく、バイト配列が受け渡しされる。

これのために各関数のバイト入出力は、ネストした「バイト配列 (Byte\[\]) の配列 (Object\[\])」で実装し、これを本説明では「バイト列」と呼ぶ。

バイト入力するコマンドレットの入力型は「バイト配列」で、バイト列 (ネストした「バイト配列の配列」) をパイプラインに与えることで個々の「バイト配列」を受け取る。また出力はバイト列 (ネストした「バイト配列の配列」) として出力され、パイプラインを通じてバイト配列単位で渡り、最終的にバイト列 (ネストした「バイト配列の配列」) が返る。但し、パイプラインの最後の出力がバイト配列× 1 つの場合は、PowerShell の配列平滑化によりネストしない 1 つのバイト配列となることに注意。

## 関数

#### Select-ByteContent

バイト列から選択したバイト列を出力する。

#### ConvertFrom-ByteContent

バイト列を HEX 文字列へ変換する。

#### ConvertTo-ByteContent

HEX 文字列をバイト列へ変換する。

#### Open-FileStream

ファイルを開き、ファイルオブジェクトを返す。ファイルオブジェクトは Close-Stream 関数またはオブジェクトのメソッドで閉じる必要がある。

#### Close-Stream

Open-FileStream で開いたファイルを閉じる。

#### Add-ByteContent

バイト列をストリームまたはファイルへ追記出力する。

#### Get-ByteContent

ストリームまたはファイルから入力したバイト列を返す。

#### Set-ByteContent

バイト列をファイルへ出力 (上書き) する。

#### Copy-Stream

ストリームとストリームまたはストリームとファイルの間で入出力する。

#### Hash-ByteContent

バイト列のハッシュ値を計算する。

#### Hash-Stream

ストリーム入力のハッシュ値を計算する。

#### Dump-ByteContent

バイト列をコンソール向けに出力する。